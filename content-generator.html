<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Generator - LinkedIn Deal Magnet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        linkedin: {
                            blue: '#0077B5',
                            dark: '#004182',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">AI Content Generator</h1>
            <p class="text-lg text-gray-600">Create LinkedIn posts that resonate with government buyers</p>
        </div>

        <!-- Content Generator Form -->
        <div id="generator-form" class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <div class="space-y-6">
                <!-- Target Agencies -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Target Agencies <span class="text-red-500">*</span>
                    </label>
                    <p class="text-sm text-gray-600 mb-3">Which agencies do you want to create content about?</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="Department of Defense" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">DoD</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="Department of Veterans Affairs" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">VA</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="Department of Homeland Security" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">DHS</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="USACE" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">USACE</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="GSA" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">GSA</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition">
                            <input type="checkbox" name="agencies" value="NASA" class="w-5 h-5 text-linkedin-blue">
                            <span class="font-medium text-sm">NASA</span>
                        </label>
                    </div>
                </div>

                <!-- Post Templates -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Post Styles <span class="text-red-500">*</span>
                    </label>
                    <p class="text-sm text-gray-600 mb-3">Select the types of posts you want to generate (choose 1-7)</p>
                    <div id="templates-container" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>

                <!-- Number of Posts -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Number of Posts
                    </label>
                    <select id="num-posts" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-linkedin-blue focus:border-transparent">
                        <option value="3">3 posts (recommended)</option>
                        <option value="5">5 posts</option>
                        <option value="7">7 posts</option>
                    </select>
                    <p class="text-sm text-gray-500 mt-2">üí° Tip: If you select more posts than templates, we'll create variations using your selected styles.</p>
                </div>

                <!-- GEO Boost Toggle -->
                <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" id="geo-boost" checked class="mt-1 w-5 h-5 text-purple-600">
                        <div>
                            <label for="geo-boost" class="font-semibold text-gray-900 cursor-pointer">
                                GEO Boost (Generative Engine Optimization)
                            </label>
                            <p class="text-sm text-gray-600 mt-1">
                                Optimize your content for AI search engines (ChatGPT, Perplexity, etc.) using question-answer format,
                                clear structure, and authoritative sources. This helps your content appear in AI-generated responses.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button onclick="generateContent()" class="w-full bg-gradient-to-r from-linkedin-blue to-purple-600 hover:from-linkedin-dark hover:to-purple-700 text-white font-bold px-8 py-4 rounded-lg transition duration-200 text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                    Generate LinkedIn Posts
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="hidden bg-white rounded-2xl shadow-xl p-8 mb-6">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-linkedin-blue mx-auto mb-4"></div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Generating Your Content...</h3>
                <div id="loading-steps" class="space-y-2 text-sm text-gray-600 max-w-md mx-auto">
                    <p id="step-1" class="opacity-50">‚úì Analyzing agency pain points and priorities</p>
                    <p id="step-2" class="opacity-50">‚è≥ Injecting statistics and sources (GEO optimization)</p>
                    <p id="step-3" class="opacity-50">‚è≥ Writing in your authentic voice</p>
                </div>
            </div>
        </div>

        <!-- Generated Posts -->
        <div id="generated-posts" class="hidden space-y-6">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Your LinkedIn Posts</h2>
                <p class="text-gray-600">Click to copy and paste into LinkedIn</p>
            </div>

            <div id="posts-container" class="space-y-6">
                <!-- Posts will be inserted here -->
            </div>

            <!-- Generate More Button -->
            <div class="text-center pt-6">
                <button onclick="resetGenerator()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold px-8 py-3 rounded-lg transition">
                    Generate More Posts
                </button>
            </div>
        </div>
    </div>

    <script>
        let userData = null;
        let availableTemplates = [];

        // Load user data and templates on page load
        window.addEventListener('DOMContentLoaded', async function() {
            const userDataStr = localStorage.getItem('user_data');
            if (userDataStr) {
                userData = JSON.parse(userDataStr);
                console.log('‚úÖ Loaded user data:', userData);
            } else {
                alert('Please complete onboarding first to use the Content Generator');
                window.location.href = '/onboarding';
                return;
            }

            // Load available templates
            await loadTemplates();
        });

        async function loadTemplates() {
            try {
                const response = await fetch('/api/content-generator/templates');
                const result = await response.json();

                if (result.success) {
                    availableTemplates = result.templates;
                    renderTemplates();
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }

        function renderTemplates() {
            const container = document.getElementById('templates-container');
            container.innerHTML = availableTemplates.map(template => `
                <label class="flex items-start gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-linkedin-blue transition bg-white">
                    <input type="checkbox" name="templates" value="${template.key}" class="mt-1 w-5 h-5 text-linkedin-blue">
                    <div class="flex-1">
                        <div class="font-semibold text-gray-900">${template.name}</div>
                        <div class="text-sm text-gray-600 mt-1">${template.description}</div>
                    </div>
                </label>
            `).join('');

            // Pre-select default templates (question-based, stat-heavy, story-driven)
            const defaultTemplates = ['question-based', 'stat-heavy', 'story-driven'];
            defaultTemplates.forEach(key => {
                const checkbox = document.querySelector(`input[name="templates"][value="${key}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }

        async function generateContent() {
            // Get selected agencies
            const selectedAgencies = Array.from(document.querySelectorAll('input[name="agencies"]:checked'))
                .map(cb => cb.value);

            if (selectedAgencies.length === 0) {
                alert('Please select at least one target agency');
                return;
            }

            // Get selected templates
            const selectedTemplates = Array.from(document.querySelectorAll('input[name="templates"]:checked'))
                .map(cb => cb.value);

            if (selectedTemplates.length === 0) {
                alert('Please select at least one post style');
                return;
            }

            const numPosts = parseInt(document.getElementById('num-posts').value);
            const geoBoost = document.getElementById('geo-boost').checked;

            // Hide form, show loading
            document.getElementById('generator-form').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            // Animate loading steps
            setTimeout(() => {
                document.getElementById('step-1').classList.remove('opacity-50');
                document.getElementById('step-1').innerHTML = '‚úì Analyzing agency pain points and priorities';
            }, 1000);

            setTimeout(() => {
                document.getElementById('step-2').classList.remove('opacity-50');
                document.getElementById('step-2').innerHTML = '‚úì Injecting statistics and sources (GEO optimization)';
            }, 3000);

            setTimeout(() => {
                document.getElementById('step-3').classList.remove('opacity-50');
                document.getElementById('step-3').innerHTML = '‚úì Writing in your authentic voice';
            }, 5000);

            try {
                const response = await fetch('/api/content-generator/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userData?.linkedinData?.email || userData?.userId,
                        userData: userData, // Send full data as fallback
                        targetAgencies: selectedAgencies,
                        numPosts: numPosts,
                        geoBoost: geoBoost,
                        templates: selectedTemplates
                    })
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate content');
                }

                displayPosts(result.posts, result.metadata);

            } catch (error) {
                console.error('Error generating content:', error);
                alert('Failed to generate content: ' + error.message);
                resetGenerator();
            }
        }

        function displayPosts(posts, metadata) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('generated-posts').classList.remove('hidden');

            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = posts.map((post, index) => `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-gray-200 hover:border-linkedin-blue transition">
                    <div class="bg-gradient-to-r from-linkedin-blue to-purple-600 px-6 py-4">
                        <div class="flex items-center justify-between flex-wrap gap-2">
                            <h3 class="text-xl font-bold text-white">Post ${index + 1}: ${post.template || post.angle}</h3>
                            <span class="bg-white/20 text-white text-xs px-3 py-1 rounded-full">${post.angle}</span>
                        </div>
                    </div>

                    <div class="p-6">
                        <!-- Post Content -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-4 border-2 border-gray-200">
                            <pre class="whitespace-pre-wrap font-sans text-gray-800 leading-relaxed">${post.content}</pre>
                            ${post.hashtags.length > 0 ? `
                            <div class="mt-4 pt-4 border-t border-gray-300">
                                <div class="flex flex-wrap gap-2">
                                    ${post.hashtags.map(tag => `<span class="text-linkedin-blue font-medium">${tag}</span>`).join(' ')}
                                </div>
                            </div>
                            ` : ''}
                        </div>

                        <!-- Meta Information -->
                        <div class="bg-purple-50 rounded-lg p-4 mb-4 text-sm">
                            <p class="font-semibold text-purple-900 mb-2">üìå Pain Point Addressed:</p>
                            <p class="text-purple-800">${post.painPointAddressed}</p>
                            ${post.stats && post.stats.length > 0 ? `
                            <p class="font-semibold text-purple-900 mt-3 mb-2">üìä Statistics Included:</p>
                            <ul class="text-purple-800 space-y-1">
                                ${post.stats.map(stat => `<li>‚Ä¢ ${stat}</li>`).join('')}
                            </ul>
                            ` : ''}
                        </div>

                        <!-- Copy Button -->
                        <button onclick="copyPost(${index})" class="w-full bg-linkedin-blue hover:bg-linkedin-dark text-white font-bold px-6 py-3 rounded-lg transition">
                            üìã Copy Post to Clipboard
                        </button>
                    </div>
                </div>
            `).join('');

            // Scroll to results
            document.getElementById('generated-posts').scrollIntoView({ behavior: 'smooth' });
        }

        function copyPost(index) {
            const posts = document.querySelectorAll('.bg-gray-50.rounded-lg.p-6.mb-4');
            const postContent = posts[index].textContent.trim();

            navigator.clipboard.writeText(postContent).then(() => {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied!';
                button.classList.add('bg-green-600');
                button.classList.remove('bg-linkedin-blue');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-linkedin-blue');
                }, 2000);
            });
        }

        function resetGenerator() {
            document.getElementById('generated-posts').classList.add('hidden');
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('generator-form').classList.remove('hidden');

            // Reset loading steps
            document.getElementById('step-1').classList.add('opacity-50');
            document.getElementById('step-1').innerHTML = '‚úì Analyzing agency pain points and priorities';
            document.getElementById('step-2').classList.add('opacity-50');
            document.getElementById('step-2').innerHTML = '‚è≥ Injecting statistics and sources (GEO optimization)';
            document.getElementById('step-3').classList.add('opacity-50');
            document.getElementById('step-3').innerHTML = '‚è≥ Writing in your authentic voice';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
